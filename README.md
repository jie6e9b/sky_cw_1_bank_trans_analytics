# Учебный проект на Python

Этот репозиторий содержит набор модулей для анализа и отображения финансовых транзакций. Модули реализуют функциональность фильтрации, агрегации, визуализации и получения данных из внешних источников.

---

## ▎Модули

### ▎1. `reports.py` — Генерация отчетов и визуализаций


**Основные функции:**
- `spending_by_category(transactions: pd.DataFrame, category: str, start_date: Optional[Union[str, datetime]] = None) -> str
  ` — Возвращает JSON-отчёт о расходах по указанной категории за 3 месяца до заданной даты.
    Args: transactions: DataFrame с транзакциями.
          category: Название категории.
          start_date: Строка в формате 'ДД.ММ.ГГГГ' или datetime (по умолчанию текущая дата).
    Returns: JSON-строка с расходами по дате и сумме.

▎Особенности:
- Встроенный логгер
  
---

### ▎2. `services.py` — Аггрегация и обработка данных

Отвечает за обобщение и расчет ключевых метрик по транзакциям.

**Основные функции:**
- `get_high_cashback_categories(df: pd.DataFrame, year: str, month: str) -> str` —
   Анализирует выгодные категории повышенного кешбэка за указанный месяц.
    Args: year (str): Год в формате YYYY.
          month (str): Месяц в формате MM.
          df (pandas.DataFrame): DataFrame с данными о расходах
    Returns: str: JSON-ответ с прогнозом начисленного кешбэка по категориям.

▎Особенности:
- Встроенный логгер

---

### ▎3. `utils.py` — Утилиты и вспомогательные функции

Содержит функции для загрузки данных, фильтрации по датам и обращения к внешним API.

**Основные функции:**
- `read_data_file()` — загрузка и предобработка Excel-файла с транзакциями.
- `get_date_range(date_time_str)` — определяет диапазон дат для анализа.
- `get_slice_of_data(start, end)` — фильтрует транзакции по диапазону дат.
- `get_summary_card_data(df)` — вычисляет суммы и кэшбэк по картам.
- `top_5_transactions_by_sum(df)` — находит топ-5 транзакций по сумме.
- `actual_currencies()` — получает текущие курсы валют (через API).
- `actual_stocks()` — получает текущие цены акций (через API).
- `get_time_for_greeting()` — возвращает приветствие в зависимости от времени суток.

▎Особенности:
- Встроенный логгер
- Поддержка мока API для офлайн-тестирования
- Маскирование номеров карт

---

### ▎4. `views.py` — Сборка итоговых данных для интерфейса

Модуль формирует финальный JSON-объект для отображения на главной странице.

**Основная функция:**
- `main_info(date_time)` — собирает приветствие, карточки, транзакции, курсы валют и акций в один JSON по заданной дате.

▎Особенности:
- Встроенный логгер
- Обработка ошибок формата даты
- Стандартизированный JSON-вывод для UI

---

## ▎Тестирование

Проект покрыт модульными тестами, реализованными с использованием `pytest`.

**Покрываемые аспекты:**
- `utils.py` — загрузка, фильтрация, API-запросы, расчеты по картам и транзакциям
- `services.py` — агрегация по категориям, дням, картам
- `reports.py` — генерация диаграмм и PDF
- `views.py` — итоговый JSON-ответ и обработка ошибок

**Запуск тестов:**
```bash
pytest tests/


